
<!doctype html>
<html>
  <head>
    <title>Request small file every 2 seconds to test TCP latency</title>
  </head>
  <body>
<h1>Request small file every 2 seconds to test TCP latency</h1>

    <script type="text/javascript">
      function getUrlValue(varSearch){
        var searchString = window.location.search.substring(1);
        var variableArray = searchString.split('&');
        for (i = 0; i < variableArray.length; i++) {
          var keyValuePair = variableArray[i].split('=');
          if (keyValuePair[0] == varSearch) {
            return keyValuePair[1];
          }
        }
      }

    </script>

    <script>
    numberOfImages = 3;
    if (getUrlValue("images")) {
      numberOfImages = getUrlValue("images");
    }
    maxClusters = 10;
    if (getUrlValue("iterations")) {
      maxClusters = getUrlValue("iterations");
    }
    var myVar = setInterval(function(){ myTimer() }, 2000);
    var randomizer = 0;

    function myTimer() {
      for (x = 0; x < numberOfImages; x++) {
        document.write("<img src='https://s.yimg.com/dh/ap/default/130909/y_200_a.png?req=" + ((randomizer + 1) * 2 - 1) + "rnd=" + Math.random() + "'>");
      }
      randomizer = randomizer + 10;
      console.log ("maxClusters = " + maxClusters + ", randomizer = " + randomizer + ", maxClusters * 10 = " + maxClusters * 10);
      if (randomizer == ((maxClusters + 1) * 10)) {
        clearInterval (myVar);
        alert("You can control images and iterations by modifying the URL as follows: latencyTest.html?images=3&iterations=10")
      }
    }
    </script>
      
  </body>
</html>